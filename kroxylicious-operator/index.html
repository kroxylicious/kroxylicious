<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.23">
<title>Kroxylicious Operator for Kubernetes</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child{border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:first-child,.sidebarblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child,.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active,#footnotes .footnote a:first-of-type:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,td.hdlist1,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.3/styles/github.min.css">
</head>
<body id="using-book-operator" class="book toc2 toc-left">
<div id="header">
<h1>Kroxylicious Operator for Kubernetes</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#assembly-overview-operator">1. Kroxylicious Operator overview</a></li>
<li><a href="#assembly-operator-api-operator">2. API concepts</a>
<ul class="sectlevel2">
<li><a href="#api_resources_used_by_the_kroxylicious_proxy">2.1. API resources used by the Kroxylicious Proxy</a></li>
<li><a href="#con-api-compatibilityoperator">2.2. Compatibility</a></li>
</ul>
</li>
<li><a href="#assembly-installing-operator">3. Installing the operator</a>
<ul class="sectlevel2">
<li><a href="#install-prereqs-operator">3.1. Install prerequisites</a></li>
<li><a href="#downloads-operator">3.2. Kroxylicious release artifacts</a></li>
<li><a href="#install-cluster-operator-operator">3.3. Installing the Kroxylicious Operator</a></li>
</ul>
</li>
<li><a href="#assembly-operator-deploying-a-proxy-operator">4. Deploying a proxy</a>
<ul class="sectlevel2">
<li><a href="#prerequisites">4.1. Prerequisites</a></li>
<li><a href="#the_required_resources">4.2. The required resources</a></li>
<li><a href="#assembly-configuring-kafkaprotocolfilters-operator">4.3. Filters</a></li>
</ul>
</li>
<li><a href="#assembly-operator-operate-proxy-operator">5. Operating a proxy</a>
<ul class="sectlevel2">
<li><a href="#con-kafkaproxy-cpu-memory-allocation-operator">5.1. Configuring Proxy container CPU and memory resource limits and requests</a></li>
</ul>
</li>
<li><a href="#assembly-operator-secure-proxy-securing">6. Securing a proxy</a>
<ul class="sectlevel2">
<li><a href="#prerequisites_2">6.1. Prerequisites</a></li>
<li><a href="#assembly-operator-secure-client-proxy-connection-securing">6.2. Securing the client-to-proxy connection</a></li>
<li><a href="#assembly-operator-secure-proxy-broker-connection-securing">6.3. Securing the proxy-to-broker connection</a></li>
<li><a href="#assembly-operator-secure-filter-securing">6.4. Securing filters</a></li>
</ul>
</li>
<li><a href="#assembly-operator-monitoring-operator">7. Monitoring</a>
<ul class="sectlevel2">
<li><a href="#con-prometheus-metrics-proxy-operator">7.1. Overview of proxy metrics</a></li>
<li><a href="#con-prometheus-metrics-operator-operator">7.2. Overview of operator metrics</a></li>
<li><a href="#con-operator-ingesting-metrics-operator">7.3. Ingesting metrics</a></li>
<li><a href="#con-operator-setting-log-levels-operator">7.4. Setting log levels</a></li>
</ul>
</li>
<li><a href="#glossary">8. Glossary</a></li>
<li><a href="#trademark_notice">9. Trademark notice</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<h3 id="about_this_guide" class="discrete">About this guide</h3>
<div class="paragraph">
<p>This guide covers using the <strong>Kroxylicious Operator</strong> to configure, deploy, secure, and operate the Kroxylicious Proxy on Kubernetes.
Refer to other Kroxylicious guides for information on running the proxy outside Kubernetes or for advanced topics such as plugin development.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="assembly-overview-operator"><a class="anchor" href="#assembly-overview-operator"></a><a class="link" href="#assembly-overview-operator">1. Kroxylicious Operator overview</a></h2>
<div class="sectionbody">
<div class="paragraph _abstract">
<p>Kroxylicious Proxy is an Apache Kafka protocol-aware ("Layer 7") proxy designed to enhance Kafka-based systems.</p>
</div>
<div class="paragraph">
<p>The Kroxylicious Operator is an <em>operator</em> for Kubernetes which simplifies deploying and operating the Kroxylicious Proxy.</p>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://kubernetes.io/" target="_blank" rel="noopener">Kubernetes website</a></p>
</li>
<li>
<p><a href="https://kubernetes.io/docs/concepts/extend-kubernetes/operator/" target="_blank" rel="noopener">Operators</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="assembly-operator-api-operator"><a class="anchor" href="#assembly-operator-api-operator"></a><a class="link" href="#assembly-operator-api-operator">2. API concepts</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="api_resources_used_by_the_kroxylicious_proxy"><a class="anchor" href="#api_resources_used_by_the_kroxylicious_proxy"></a><a class="link" href="#api_resources_used_by_the_kroxylicious_proxy">2.1. API resources used by the Kroxylicious Proxy</a></h3>
<div class="paragraph">
<p>The operator takes these custom resources and core Kubernetes resources as inputs:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>KafkaProxy</code></dt>
<dd>
<p>Defines an instance of the proxy.</p>
</dd>
<dt class="hdlist1"><code>VirtualKafkaCluster</code></dt>
<dd>
<p>Represents a logical Kafka cluster that will be exposed to Kafka clients.</p>
</dd>
<dt class="hdlist1"><code>KafkaProxyIngress</code></dt>
<dd>
<p>Configures how a virtual cluster is exposed on the network to Kafka clients.</p>
</dd>
<dt class="hdlist1"><code>KafkaService</code></dt>
<dd>
<p>Specifies a <em>backend</em> Kafka cluster for a virtual cluster.</p>
</dd>
<dt class="hdlist1"><code>KafkaProtocolFilter</code></dt>
<dd>
<p>Specifies filter mechanisms for use with a virtual cluster.</p>
</dd>
<dt class="hdlist1"><code>Secret</code></dt>
<dd>
<p><code>KafkaService</code> and <code>KafkaProtocolFilter</code> resources may reference a <code>Secret</code> to provide security-sensitive data such as TLS certificates or passwords.</p>
</dd>
<dt class="hdlist1"><code>ConfigMap</code></dt>
<dd>
<p><code>KafkaService</code> and <code>KafkaProtocolFilter</code> resources may reference a <code>ConfigMap</code> to provide non-sensitive configuration such as trusted CA certificates.</p>
</dd>
</dl>
</div>
<div class="imageblock">
<div class="content">
<img src="../_assets/operator-input-resource-topology.svg" alt="Diagram showing the input resources, KafkaProxy, VirtualKafkaCluster, etc, as boxes, connected by arrows representing the references between the resources.">
</div>
<div class="title">Figure 1. Example input resources and the references between them</div>
</div>
<div class="paragraph">
<p>Based on the input resources, the operator generates the core Kubernetes resources needed to deploy the Kroxylicious Proxy, such as the following:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>ConfigMap</code></dt>
<dd>
<p>Provides the proxy configuration file mounted into the proxy container.</p>
</dd>
<dt class="hdlist1"><code>Deployment</code></dt>
<dd>
<p>Manages the proxy <code>Pod</code> and container.</p>
</dd>
<dt class="hdlist1"><code>Service</code></dt>
<dd>
<p>Exposes the proxy over the network to other workloads in the same Kubernetes cluster.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The API is decomposed into multiple custom resources in a similar way to the Kubernetes Gateway API, and for similar reasons.
You can make use of Kubernete&#8217;s Role-Based Access Control (RBAC) to divide responsibility for different aspects of the overall proxy functionality to different roles (people) in your organization.</p>
</div>
<div class="paragraph">
<p>For example, you might grant networking engineers the ability to configure <code>KafkaProxy</code> and <code>KafkaProxyIngress</code>, while giving application developers the ability to configure <code>VirtualKafkaCluster</code>, <code>KafkaService</code>, and <code>KafkaProtocolFilter</code> resources.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_assets/operator-output-resource-topology.svg" alt="Diagram showing the output resources, Deployment, Pod, ConfigMap, Service, with arrows showing the Deployment managing the Pod, the Pod mounting the ConfigMap, and the Service selecting the Pod.">
</div>
<div class="title">Figure 2. Generated Kubernetes resources and the relationships between them</div>
</div>
</div>
<div class="sect2">
<h3 id="con-api-compatibilityoperator"><a class="anchor" href="#con-api-compatibilityoperator"></a><a class="link" href="#con-api-compatibilityoperator">2.2. Compatibility</a></h3>
<div class="sect3">
<h4 id="con-api-compatibility-apioperator"><a class="anchor" href="#con-api-compatibility-apioperator"></a><a class="link" href="#con-api-compatibility-apioperator">2.2.1. Custom resource APIs</a></h4>
<div class="paragraph">
<p>Kroxylicious custom resource definitions are packaged and deployed alongside the operator. Currently, there&#8217;s only a single version  of the custom resource APIs: <code>v1alpha1</code>.</p>
</div>
<div class="paragraph">
<p>Future updates to the operator may introduce new versions of the custom resource APIs. At that time the operator will be backwards compatible with older versions of those APIs and an upgrade procedure will be used to upgrade existing custom resources to the new API version.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="assembly-installing-operator"><a class="anchor" href="#assembly-installing-operator"></a><a class="link" href="#assembly-installing-operator">3. Installing the operator</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section provides instructions for installing the Kroxylicious Operator.</p>
</div>
<div class="paragraph">
<p>Installation options and procedures are demonstrated using the example files included with Kroxylicious.</p>
</div>
<div class="sect2">
<h3 id="install-prereqs-operator"><a class="anchor" href="#install-prereqs-operator"></a><a class="link" href="#install-prereqs-operator">3.1. Install prerequisites</a></h3>
<div class="paragraph">
<p>To install Kroxylicious, you will need the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A Kubernetes 1.31 or later cluster.
For development purposes, <a href="https://minikube.sigs.k8s.io/">Minikube</a> may be used.</p>
</li>
<li>
<p>The <code>kubectl</code> command-line tool to be installed and configured to connect to the running cluster.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information on the tools available for running Kubernetes, see <a href="https://kubernetes.io/docs/tasks/tools/" target="_blank" rel="noopener">Install Tools</a> in the Kubernetes documentation.</p>
</div>
</div>
<div class="sect2">
<h3 id="downloads-operator"><a class="anchor" href="#downloads-operator"></a><a class="link" href="#downloads-operator">3.2. Kroxylicious release artifacts</a></h3>
<div class="paragraph _abstract">
<p>To use YAML manifest files to install Kroxylicious, download  kroxylicious-operator-0.13.zip or kroxylicious-operator-0.13.tar.gz file from the <a href="https://github.com/kroxylicious/kroxylicious/releases" target="_blank" rel="noopener">GitHub releases page</a>, and extract the files as appropriate (for example using <code>unzip</code> or <code>tar -xzf</code>).</p>
</div>
<div class="paragraph">
<p>Each of these archives contains:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Installation Files</dt>
<dd>
<p>In the <code>install</code> directory are the YAML manifests needed to install the operator.</p>
</dd>
<dt class="hdlist1">Examples</dt>
<dd>
<p>In the <code>examples</code> directory are examples of the custom resources which can be used to deploy a proxy once the operator has been installed.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="install-cluster-operator-operator"><a class="anchor" href="#install-cluster-operator-operator"></a><a class="link" href="#install-cluster-operator-operator">3.3. Installing the Kroxylicious Operator</a></h3>
<div class="paragraph _abstract">
<p>This procedure shows how to install the Kroxylicious Operator in your Kubernetes cluster.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You need an account with permission to create and manage <code>CustomResourceDefinition</code> and RBAC (<code>ClusterRole</code>) resources.</p>
</li>
<li>
<p>You have downloaded the <a href="#downloads-operator">release artifacts</a> and extracted the contents into the current directory.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Edit the Kroxylicious installation files to use the namespace the operator is going to be installed into.</p>
<div class="paragraph">
<p>For example, in this procedure the operator is installed into the namespace <code>my-kroxylicious-operator-namespace</code>.</p>
</div>
<div class="paragraph">
<p>On Linux, use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">sed -i 's/namespace: .*/namespace: my-kroxylicious-operator-namespace/' install/*.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>On MacOS, use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">sed -i '' 's/namespace: .*/namespace: my-kroxylicious-operator-namespace/' install/*.yaml</code></pre>
</div>
</div>
</li>
<li>
<p>Deploy the Kroxylicious operator:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl create -f install</code></pre>
</div>
</div>
</li>
<li>
<p>Check the status of the deployment:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl get deployments -n my-kroxylicious-operator-namespace</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Output shows the deployment name and readiness</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">NAME                      READY  UP-TO-DATE  AVAILABLE
kroxylicious-operator     1/1    1           1</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>READY</code> shows the number of replicas that are ready/expected.
The deployment is successful when the <code>AVAILABLE</code> output shows <code>1</code>.</p>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="assembly-operator-deploying-a-proxy-operator"><a class="anchor" href="#assembly-operator-deploying-a-proxy-operator"></a><a class="link" href="#assembly-operator-deploying-a-proxy-operator">4. Deploying a proxy</a></h2>
<div class="sectionbody">
<div class="paragraph _abstract">
<p>Deploy a basic proxy instance with a single virtual cluster exposed to Kafka clients on the same Kubernetes cluster.</p>
</div>
<div class="sect2">
<h3 id="prerequisites"><a class="anchor" href="#prerequisites"></a><a class="link" href="#prerequisites">4.1. Prerequisites</a></h3>
<div class="ulist">
<ul>
<li>
<p>The Kroxylicious Operator is installed in the Kubernetes cluster.</p>
</li>
<li>
<p>A Kafka cluster is available to be proxied.</p>
</li>
<li>
<p>TLS certificate generation capability is available for ingress configurations that require TLS.</p>
</li>
<li>
<p>DNS management access is available for ingress configurations that require off-cluster access.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="the_required_resources"><a class="anchor" href="#the_required_resources"></a><a class="link" href="#the_required_resources">4.2. The required resources</a></h3>
<div class="sect3">
<h4 id="con-kafkaproxy-operator"><a class="anchor" href="#con-kafkaproxy-operator"></a><a class="link" href="#con-kafkaproxy-operator">4.2.1. Proxy configuration to host virtual clusters</a></h4>
<div class="paragraph">
<p>A <code>KafkaProxy</code> resource represents an instance of the Kroxylicious Proxy.
Conceptually, it is the top-level resource that links together <code>KafkaProxyIngress</code>, <code>VirtualKafkaCluster</code>, <code>KafkaService</code>, and <code>KafkaProtocolFilter</code> resources to form a complete working proxy.</p>
</div>
<div class="paragraph">
<p><code>KafkaProxy</code> resources are referenced by <code>KafkaProxyIngress</code> and <code>VirtualKafkaCluster</code> resources to define how the proxy is exposed and what it proxies.</p>
</div>
<div class="listingblock">
<div class="title">Example <code>KafkaProxy</code> configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">kind: KafkaProxy
apiVersion: kroxylicious.io/v1alpha1
metadata:
  namespace: my-proxy
  name: simple
spec: {} <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>An empty <code>spec</code> creates a proxy with default configuration.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="con-configuring-kafkaproxyingress-overview-operator"><a class="anchor" href="#con-configuring-kafkaproxyingress-overview-operator"></a><a class="link" href="#con-configuring-kafkaproxyingress-overview-operator">4.2.2. Networking configuration</a></h4>
<div class="paragraph">
<p>A <code>KafkaProxyIngress</code> resource defines the networking configuration that allows Kafka clients to connect to a <code>VirtualKafkaCluster</code>.</p>
</div>
<div class="paragraph">
<p>It is uniquely associated with a single <code>KafkaProxy</code> instance, but it is not uniquely associated with a <code>VirtualKafkaCluster</code> and can be used by multiple <code>VirtualKafkaCluster</code> instances.</p>
</div>
<div class="paragraph">
<p>The <code>KafkaProxyIngress</code> resource supports the following ingress types to configure networking access to the virtual cluster:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>clusterIP</code> exposes the virtual cluster to applications running inside the same Kubernetes cluster as the proxy.</p>
</li>
<li>
<p><code>loadBalancer</code> exposes the virtual cluster to applications running outside the Kubernetes cluster.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>clusterIP</code> ingress types support both TCP (plain) and TLS connections.
The <code>loadBalancer</code> type exclusively supports TLS.</p>
</div>
<div class="paragraph">
<p>When using TLS, you specify a TLS server certificate in the ingress configuration of the <code>VirtualKafkaCluster</code> resource.</p>
</div>
<div class="paragraph">
<p>When using <code>loadBalancer</code>, changes to your DNS may be required.</p>
</div>
<div class="paragraph">
<p>The following table summarizes the supported ingress types.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Supported ingress types</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Ingress Type</th>
<th class="tableblock halign-left valign-top">Use case</th>
<th class="tableblock halign-left valign-top">Supported Transport</th>
<th class="tableblock halign-left valign-top">Requires DNS changes?</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>clusterIP</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">On-cluster applications</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP/TLS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>loadBalancer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Off-cluster applications</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TLS only</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
TLS is recommended when connecting applications in a production environment.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="clusterip_ingress_type"><a class="anchor" href="#clusterip_ingress_type"></a><a class="link" href="#clusterip_ingress_type"><code>clusterIP</code> ingress type</a></h5>
<div class="paragraph">
<p>The <code>clusterIP</code> ingress type exposes virtual clusters to Kafka clients running in the same Kubernetes cluster as the proxy.
It supports both TCP (plain) and TLS connections.</p>
</div>
<div class="paragraph">
<p>The <code>clusterIP</code> ingress type uses Kubernetes <code>Service</code> resources of type <code>ClusterIP</code> to enable on-cluster access.</p>
</div>
<div class="listingblock">
<div class="title">Example <code>KafkaProxyIngress</code> configuration for <code>clusterIP</code> with TCP</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">kind: KafkaProxyIngress
apiVersion: kroxylicious.io/v1alpha1
metadata:
  namespace: my-proxy
  name: cluster-ip
spec:
  proxyRef: <i class="conum" data-value="1"></i><b>(1)</b>
    name: simple
  clusterIP: <i class="conum" data-value="2"></i><b>(2)</b>
    protocol: TCP <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Identifies the <code>KafkaProxy</code> resource that this ingress is part of.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Specifies <code>clusterIP</code> networking.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Defines the connection protocol as plain <code>TCP</code>. Use <code>TLS</code> to enable encrypted communication between clients and the proxy.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example <code>KafkaProxyIngress</code> configuration for <code>clusterIP</code> with TLS</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">kind: KafkaProxyIngress
apiVersion: kroxylicious.io/v1alpha1
metadata:
  namespace: my-proxy
  name: cluster-ip
spec:
  proxyRef: <i class="conum" data-value="1"></i><b>(1)</b>
    name: simple
  clusterIP: <i class="conum" data-value="2"></i><b>(2)</b>
    protocol: TLS <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="paragraph">
<p>When using TLS, specify a <a href="#con-virtualkafkacluster-clusterip-generate-tls-certificates-operator">TLS server certificate</a> in the <a href="#con-virtualkafkacluster-overview-operator">ingress configuration</a> of the <code>VirtualKafkaCluster</code> resource using a <code>certificateRef</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="loadbalancer_ingress_type"><a class="anchor" href="#loadbalancer_ingress_type"></a><a class="link" href="#loadbalancer_ingress_type"><code>loadBalancer</code> ingress type</a></h5>
<div class="paragraph">
<p>The <code>loadBalancer</code> ingress type allows applications running off-cluster to connect to the virtual cluster.
TLS must be used with this ingress type.</p>
</div>
<div class="paragraph">
<p>The <code>loadBalancer</code> ingress type uses Kubernetes <code>Service</code> resources of type <code>LoadBalancer</code> to enable off-cluster access.</p>
</div>
<div class="paragraph">
<p>When using a loadBalancer ingress, the proxy uses SNI (Server Name Indication) to match the client’s requested host name to the correct virtual cluster and broker within the proxy.
This means that every virtual cluster and every broker within the virtual cluster <strong>must</strong> be uniquely identifiable within DNS.
To accomplish this, the following configuration must be provided:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A unique <code>bootstrapAddress</code>. This is the address that the clients initially use to connect to the virtual cluster.</p>
</li>
<li>
<p>An <code>advertisedBrokerAddressPattern</code> that generates unique broker addresses which clients use to connect to individual brokers.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You decide how to formulate the <code>bootstrapAddress</code> and the <code>advertisedBrokerAddressPattern</code> to best fit the networking conventions of your organization.</p>
</div>
<div class="paragraph">
<p>The <code>advertisedBrokerAddressPattern</code> <strong>must</strong> contain the token <code>$(nodeId)</code>.
The proxy replaces this token with the broker&#8217;s node ID.
This ensures that client connections are correctly routed to the intended broker.</p>
</div>
<div class="paragraph">
<p>Both <code>bootstrapAddress</code> and <code>advertisedBrokerAddressPattern</code> <strong>may</strong> contain the token <code>$(virtualClusterName)</code>.
If this is present, it is replaced by the virtual cluster&#8217;s name.
This token is necessary when the <code>KafkaProxyIngress</code> is being shared by many virtual clusters.</p>
</div>
<div class="paragraph">
<p>One possible scheme is to use the virtual cluster&#8217;s name as a subdomain within your organisation&#8217;s domain name:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">$(virtualClusterName).kafkaproxy.example.com</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can then use a further subdomain for each broker:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">broker-$(nodeId).$(virtualClusterName).kafkaproxy.example.com</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use other naming schemes, as long as each address remains unique.</p>
</div>
<div class="listingblock">
<div class="title">Example <code>KafkaProxyIngress</code> configuration for <code>loadBalancer</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">kind: KafkaProxyIngress
apiVersion: kroxylicious.io/v1alpha1
metadata:
  namespace: my-proxy
  name: load-balancer
spec:
  proxyRef: <i class="conum" data-value="1"></i><b>(1)</b>
    name: simple
  loadBalancer: <i class="conum" data-value="2"></i><b>(2)</b>
    bootstrapAddress: "$(virtualClusterName).kafkaproxy.example.com" <i class="conum" data-value="3"></i><b>(3)</b>
    advertisedBrokerAddressPattern: "broker-$(nodeId).$(virtualClusterName).kafkaproxy.example.com" <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Identifies the <code>KafkaProxy</code> resource that this ingress is part of.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Specifies <code>loadBalancer</code> networking.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The bootstrap address for clients to connect to the virtual cluster.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The advertised broker address used by the proxy to generate the individual broker addresses presented to the client.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When using TLS, specify a <a href="#con-virtualkafkacluster-loadbalancer-generate-tls-certificates-operator">TLS server certificate</a> in the <a href="#con-virtualkafkacluster-overview-operator">ingress configuration</a> of the <code>VirtualKafkaCluster</code> resource using a <code>certificateRef</code>.</p>
</div>
<div class="paragraph">
<p>You must also <a href="#proc-virtualkafkacluster-loadbalancer-dns-config-operator">configure DNS</a> so that the bootstrap and broker address resolve from the network used by the applications.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="con-configuring-kafkaservice-bootstrap-operator"><a class="anchor" href="#con-configuring-kafkaservice-bootstrap-operator"></a><a class="link" href="#con-configuring-kafkaservice-bootstrap-operator">4.2.3. Configuration for proxied Kafka clusters</a></h4>
<div class="paragraph">
<p>A proxied Kafka cluster is configured in a <code>KafkaService</code> resource, which specifies how the proxy connects to the cluster.
The Kafka cluster may or may not be running in the same Kubernetes cluster as the proxy: Network connectivity is all that&#8217;s required.</p>
</div>
<div class="paragraph">
<p>This example shows a <code>KafkaService</code> defining how to connect to a Kafka cluster at <code>kafka.example.com</code>.</p>
</div>
<div class="listingblock">
<div class="title">Example <code>KafkaService</code> configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">kind: KafkaService
metadata:
  # ...
spec:
  bootstrapServers: kafka.example.com:9092 <i class="conum" data-value="1"></i><b>(1)</b>
  nodeIdRanges: <i class="conum" data-value="2"></i><b>(2)</b>
    - name: brokers <i class="conum" data-value="3"></i><b>(3)</b>
      start: 0 <i class="conum" data-value="4"></i><b>(4)</b>
      end: 5 <i class="conum" data-value="5"></i><b>(5)</b>
  # ...</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>bootstrapServers</code> property is a comma-separated list of addresses in <code>&lt;host&gt;:&lt;port&gt;</code> format. Including multiple broker addresses helps clients connect when one is unavailable.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>nodeIdRanges</code> declares the IDs of all the broker nodes in the Kafka cluster</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>name</code> is optional, but specifying it can make errors easier to diagnose.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The start of the ID range, inclusive.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The end of the ID range, inclusive.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="con-virtualkafkacluster-overview-operator"><a class="anchor" href="#con-virtualkafkacluster-overview-operator"></a><a class="link" href="#con-virtualkafkacluster-overview-operator">4.2.4. Virtual cluster configuration</a></h4>
<div class="paragraph">
<p>A <code>VirtualKafkaCluster</code> resource defines a logical Kafka cluster that is accessible to clients over the network.</p>
</div>
<div class="paragraph">
<p>The virtual cluster references the following resources, which must be in the same namespace:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <code>KafkaProxy</code> resource that the proxy is part of.</p>
</li>
<li>
<p>One or more <code>KafkaProxyIngress</code> resources that expose the virtual cluster to Kafka clients and provide virtual-cluster-specific configuration to the ingress (such as TLS certificates and other parameters).</p>
</li>
<li>
<p>A <code>KafkaService</code> resource that defines the backend Kafka cluster.</p>
</li>
<li>
<p>Zero or more <code>KafkaProtocolFilter</code> resources that apply filters to the Kafka protocol traffic passing between clients and the backend Kafka cluster.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This example shows a <code>VirtualKafkaCluster</code>, exposing it to Kafka clients running on the same Kubernetes cluster.
It uses plain TCP (as opposed to TLS) as the transport protocol.</p>
</div>
<div class="listingblock">
<div class="title">Example <code>VirtualKafkaCluster</code> configuration with single <code>clusterIP</code> ingress</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">kind: VirtualKafkaCluster
apiVersion: kroxylicious.io/v1alpha1
metadata:
  name: my-cluster
  namespace: my-proxy
spec:
  proxyRef: <i class="conum" data-value="1"></i><b>(1)</b>
    name: simple
  targetKafkaServiceRef: <i class="conum" data-value="2"></i><b>(2)</b>
    name: my-cluster
  ingresses:
    - ingressRef: <i class="conum" data-value="3"></i><b>(3)</b>
        name: cluster-ip</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Identifies the <code>KafkaProxy</code> resource that this virtual cluster is part of.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>KafkaService</code> that defines the Kafka cluster proxied by the virtual cluster.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Ingresses that expose the virtual cluster.
Each ingress references a <code>KafkaProxyIngress</code> by name.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This example shows a <code>VirtualKafkaCluster</code>, exposing it to Kafka clients running both on and off-cluster, both using TLS.
Because TLS is used, the ingress configuration must reference a TLS server certificate.</p>
</div>
<div class="listingblock">
<div class="title">Example <code>VirtualKafkaCluster</code> configuration with two ingresses using TLS</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">kind: VirtualKafkaCluster
apiVersion: kroxylicious.io/v1alpha1
metadata:
  name: my-cluster
  namespace: my-proxy
spec:
  proxyRef:
    name: simple
  targetKafkaServiceRef:
    name: my-cluster
  ingresses:
    - ingressRef:
        name: cluster-ip
        certificateRef:
          name: 'cluster-ip-server-cert' <i class="conum" data-value="1"></i><b>(1)</b>
          kind: Secret
    - ingressRef:
        name: load-balancer
        certificateRef:
          name: 'external-server-cert' <i class="conum" data-value="2"></i><b>(2)</b>
          kind: Secret</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Reference to a secret containing the server certificate for the <code>clusterIP</code> ingress.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Reference to a secret containing the server certificate for the <code>loadBalancer</code> ingress.</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="con-virtualkafkacluster-clusterip-generate-tls-certificates-operator"><a class="anchor" href="#con-virtualkafkacluster-clusterip-generate-tls-certificates-operator"></a><a class="link" href="#con-virtualkafkacluster-clusterip-generate-tls-certificates-operator">Generating TLS certificates for <code>clusterIP</code> ingress type</a></h5>
<div class="paragraph _abstract">
<p>When using the <code>clusterIP</code> ingress type with the <code>TLS</code> protocol, you must provide suitable TLS certificates to secure communication.</p>
</div>
<div class="paragraph">
<p>The basic steps are as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Generate a TLS server certificate that covers the service names assigned to the virtual cluster by the ingress.</p>
</li>
<li>
<p>Provide the certificate to the virtual cluster using a Kubernetes <code>Secret</code> of type <code>kubernetes.io/tls</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The exact procedure for generating the certificate depends on the tooling and processes used by your organization.</p>
</div>
<div class="paragraph">
<p>The certificate must meet the following criteria:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The certificate needs to be signed by a CA that is trusted by the <strong>on-cluster applications</strong> that connect to the virtual cluster.</p>
</li>
<li>
<p>The format of the certificate must be PKCS#8 encoded PEM (Privacy Enhanced Mail).
It must not be password protected.</p>
</li>
<li>
<p>The certificate must use SANs (Subject Alternate Names) to list all service names or use a wildcard TLS certificate that covers them all.
Assuming a virtual cluster name of <code>my-cluster</code>, an ingress name of <code>cluster-ip</code>, and a Kafka cluster using node IDs (0-2), the following SANs must be listed in the certificate:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">my-cluster-cluster-ip-bootstrap.&lt;namespace&gt;.svc.cluster.local
my-cluster-cluster-ip-0.&lt;namespace&gt;.svc.cluster.local
my-cluster-cluster-ip-1&lt;namespace&gt;.svc.cluster.local
my-cluster-cluster-ip-2&lt;namespace&gt;.svc.cluster.local</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Create a secret for the certificate using the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shel hljs" data-lang="shel">kubectl create secret tls &lt;secret-name&gt; --namespace &lt;namespace&gt; --cert=&lt;path/to/cert/file&gt; \ --key=&lt;path/to/key/file&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>&lt;secret-name&gt;</code> is the name of the secret to be created, <code>&lt;namespace&gt;</code> is the name of the namespace where the proxy is to be deployed, and <code>&lt;path/to/cert/file&gt;</code> and <code>&lt;path/to/key/file&gt;</code> are the paths to the certificate and key files.</p>
</div>
</div>
<div class="sect4">
<h5 id="con-virtualkafkacluster-loadbalancer-generate-tls-certificates-operator"><a class="anchor" href="#con-virtualkafkacluster-loadbalancer-generate-tls-certificates-operator"></a><a class="link" href="#con-virtualkafkacluster-loadbalancer-generate-tls-certificates-operator">Generating TLS certificates for <code>loadBalancer</code> ingress type</a></h5>
<div class="paragraph _abstract">
<p>When using <code>loadBalancer</code> ingress type, you must provide suitable TLS certificates to secure communication.</p>
</div>
<div class="paragraph">
<p>The basic steps are as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Generate a TLS server certificate that covers the bootstrap and broker names assigned to the virtual cluster by the ingress.</p>
</li>
<li>
<p>Provide the certificate to the virtual cluster using a Kubernetes <code>Secret</code> of type <code>kubernetes.io/tls</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The exact procedure for generating the certificate depends on the tooling and processes used by your organization.</p>
</div>
<div class="paragraph">
<p>The certificate must meet the following criteria:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The certificate needs to be signed by a CA that is trusted by the <strong>off-cluster applications</strong> that connect to the virtual cluster.</p>
</li>
<li>
<p>The format of the certificate must be PKCS#8 encoded PEM (Privacy Enhanced Mail).
It must not be password protected.</p>
</li>
<li>
<p>The certificate must use SANs (Subject Alternate Names) to list the bootstrap and all the broker names or use a wildcard TLS certificate that covers them all.
Assuming a <code>bootstrapAddress</code> of <code>$(virtualClusterName).kafkaproxy.example.com</code>, an <code>advertisedBrokerAddressPattern</code> of <code>broker-$(nodeId).$(virtualClusterName).kafkaproxy.example.com</code>, a Kafka cluster using node IDs (0-2), and a virtual cluster name of <code>my-cluster</code>, the following SANs must be listed in the certificate:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">mycluster.kafkaproxy.example.com
broker-0.mycluster.kafkaproxy.example.com
broker-1.mycluster.kafkaproxy.example.com
broker-2.mycluster.kafkaproxy.example.com</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Create a secret for the certificate using the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shel hljs" data-lang="shel">kubectl create secret tls &lt;secret-name&gt; --namespace &lt;namespace&gt; --cert=&lt;path/to/cert/file&gt; \ --key=&lt;path/to/key/file&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>&lt;secret-name&gt;</code> is the name of the secret to be created, <code>&lt;namespace&gt;</code> is the name of the namespace where the proxy is to be deployed, and <code>&lt;path/to/cert/file&gt;</code> and <code>&lt;path/to/key/file&gt;</code> are the paths to the certificate and key files.</p>
</div>
</div>
<div class="sect4">
<h5 id="proc-virtualkafkacluster-loadbalancer-dns-config-operator"><a class="anchor" href="#proc-virtualkafkacluster-loadbalancer-dns-config-operator"></a><a class="link" href="#proc-virtualkafkacluster-loadbalancer-dns-config-operator">Configuring DNS  for load balancer ingress</a></h5>
<div class="paragraph _abstract">
<p>When using the <code>loadBalancer</code> ingress type, you must ensure that both the <code>bootstrapAddress</code> and the names generated from <code>advertisedBrokerAddressPattern</code> resolve to the <strong>external address</strong> of the Kubernetes <code>Service</code> underlying the load balancer on the <strong>network where the off-cluster applications run</strong>.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The Kroxylicious Operator is installed.</p>
</li>
<li>
<p><code>KafkaProxy</code>, <code>VirtualKafkaCluster</code>, and <code>KafkaProxyIngress</code> resources are deployed.</p>
</li>
<li>
<p>The <code>VirtualKafkaCluster</code> and <code>KafkaProxyIngress</code> resources are configured to use a <code>loadBalancer</code> ingress.</p>
</li>
<li>
<p>DNS can be configured on the network where the off-cluster applications run.</p>
</li>
<li>
<p>Network traffic can to flow from the application network run to the external addresses provided by the Kubernetes cluster.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>If using Minikube as your Kubernetes environment, enable the <a href="https://minikube.sigs.k8s.io//docs/commands/tunnel/">Minikube Load Balancer tunnel</a> by running the following command.
Use a separate console window to do this as the command needs to stay running for the tunnel to work.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">minikube tunnel</code></pre>
</div>
</div>
</li>
<li>
<p>Run the following command to discover the <strong>external address</strong> being used by the load balancer:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">kubectl get virtualkafkacluster -n &lt;namespace&gt; &lt;virtual-cluster-name&gt; -o=jsonpath='{.status.ingresses[?(@.name == "&lt;ingress-name&gt;")].loadBalancerIngressPoints}'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Replace <code>&lt;namespace&gt;</code> with the name of the Kubernetes namespace where the resources are deployed, replace <code>&lt;ingress-name&gt;</code> with
the name of the KafkaProxyIngresses and replace <code>&lt;virtual-cluster-name&gt;</code> with the name of the <code>VirtualKafkaCluster</code> resource.</p>
</div>
<div class="paragraph">
<p>Depending on your Kubernetes environment, the command returns an object containing an IP address or a hostname.
This is the external address of the load balancer.</p>
</div>
</li>
<li>
<p>Configure your DNS so that the bootstrap and broker names resolve to the external address.</p>
<div class="paragraph">
<p>Assuming a <code>bootstrapAddress</code> of <code>$(virtualClusterName).kafkaproxy.example.com</code>, an <code>advertisedBrokerAddressPattern</code> of <code>broker-$(nodeId).$(virtualClusterName).kafkaproxy.example.com</code>,
a Kafka cluster uses node IDs (0-2), and a virtual cluster name of <code>my-cluster</code>, the following DNS mappings are listed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">my-cluster.kafkaproxy.example.com =&gt; &lt;external address&gt;
broker-0.my-cluster.kafkaproxy.example.com =&gt; &lt;external address&gt;
broker-1.my-cluster.kafkaproxy.example.com =&gt; &lt;external address&gt;
broker-2.my-cluster.kafkaproxy.example.com =&gt; &lt;external address&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The exact steps vary by environment and network setup.</p>
</div>
</li>
<li>
<p>Confirm that the names resolve from the application network:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">nslookup mycluster.kafkaproxy.example.com
nslookup broker-0.mycluster.kafkaproxy.example.com</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="assembly-configuring-kafkaprotocolfilters-operator"><a class="anchor" href="#assembly-configuring-kafkaprotocolfilters-operator"></a><a class="link" href="#assembly-configuring-kafkaprotocolfilters-operator">4.3. Filters</a></h3>
<div class="paragraph _abstract">
<p>A <code>KafkaProtocolFilter</code> resource represents a Kroxylicious Proxy filter.
It is not uniquely associated with a <code>VirtualKafkaCluster</code> or <code>KafkaProxy</code> instance; it can be used in a number of <code>VirtualKafkaCluster</code> instances in the same namespace.</p>
</div>
<div class="paragraph">
<p>A <code>KafkaProtocolFilter</code> is similar to one of the items in a proxy configuration&#8217;s <code>filterDefinitions</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The resource&#8217;s <code>metadata.name</code> corresponds directly to the <code>name</code> of a <code>filterDefinitions</code> item.</p>
</li>
<li>
<p>The resource&#8217;s <code>spec.type</code> corresponds directly to the <code>type</code> of a <code>filterDefinitions</code> item.</p>
</li>
<li>
<p>The resource&#8217;s <code>spec.configTemplate</code> corresponds to the <code>config</code> of a <code>filterDefinitions</code> item, but is subject to interpolation by the operator.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="assembly-operator-operate-proxy-operator"><a class="anchor" href="#assembly-operator-operate-proxy-operator"></a><a class="link" href="#assembly-operator-operate-proxy-operator">5. Operating a proxy</a></h2>
<div class="sectionbody">
<div class="paragraph _abstract">
<p>Operate a deployed proxy by configuring its resource allocations.</p>
</div>
<div class="paragraph">
<p>This section assumes you have a running Kroxylicious Proxy instance.</p>
</div>
<div class="sect2">
<h3 id="con-kafkaproxy-cpu-memory-allocation-operator"><a class="anchor" href="#con-kafkaproxy-cpu-memory-allocation-operator"></a><a class="link" href="#con-kafkaproxy-cpu-memory-allocation-operator">5.1. Configuring Proxy container CPU and memory resource limits and requests</a></h3>
<div class="paragraph">
<p>When you define a <code>KafkaProxy</code> resource, a number of Kubernetes <code>Pods</code> are created, each with a proxy container.
Each of these containers runs a single Kroxylicious Proxy process.</p>
</div>
<div class="paragraph">
<p>By default, these proxy containers are defined without resource limits.
To manage CPU and memory consumption in your environment, modify the <code>proxyContainer</code> section within your <code>KafkaProxy</code> specification.</p>
</div>
<div class="listingblock">
<div class="title">Example <code>KafkaProxy</code> configuration with proxy container resource specification</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">kind: KafkaProxy
apiVersion: kroxylicious.io/v1alpha1
metadata:
  namespace: my-proxy
  name: simple
spec:
  infrastructure:
    proxyContainer:
      resources:
        requests:
          cpu: '400m'
          memory: '656Mi'
        limits:
          cpu: '500m'
          memory: '756Mi'</code></pre>
</div>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/" target="_blank" rel="noopener">Kubernetes documentation: Resource Management for Pods and Containers</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="assembly-operator-secure-proxy-securing"><a class="anchor" href="#assembly-operator-secure-proxy-securing"></a><a class="link" href="#assembly-operator-secure-proxy-securing">6. Securing a proxy</a></h2>
<div class="sectionbody">
<div class="paragraph _abstract">
<p>Secure proxies by using TLS and storing sensitive values in external resources.</p>
</div>
<div class="sect2">
<h3 id="prerequisites_2"><a class="anchor" href="#prerequisites_2"></a><a class="link" href="#prerequisites_2">6.1. Prerequisites</a></h3>
<div class="ulist">
<ul>
<li>
<p>A running Kroxylicious Proxy instance</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="assembly-operator-secure-client-proxy-connection-securing"><a class="anchor" href="#assembly-operator-secure-client-proxy-connection-securing"></a><a class="link" href="#assembly-operator-secure-client-proxy-connection-securing">6.2. Securing the client-to-proxy connection</a></h3>
<div class="paragraph _abstract">
<p>Secure client-to-proxy communications using TLS.</p>
</div>
<div class="sect3">
<h4 id="con-configuring-virtualkafkacluster-securing"><a class="anchor" href="#con-configuring-virtualkafkacluster-securing"></a><a class="link" href="#con-configuring-virtualkafkacluster-securing">6.2.1. TLS configuration for client-to-proxy connections</a></h4>
<div class="paragraph">
<p>This example shows a <code>VirtualKafkaCluster</code>, exposing it to Kafka clients running on the same Kubernetes cluster.
It uses TLS as the transport protocol so that communication between Kafka clients and the proxy is encrypted.</p>
</div>
<div class="listingblock">
<div class="title">Example <code>VirtualKafkaCluster</code> configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">kind: VirtualKafkaCluster
apiVersion: kroxylicious.io/v1alpha1
metadata:
  name: my-cluster
  namespace: my-proxy
spec:
  proxyRef: <i class="conum" data-value="1"></i><b>(1)</b>
    name: simple
  targetKafkaServiceRef: <i class="conum" data-value="2"></i><b>(2)</b>
    name: my-cluster
  ingresses:
    - ingressRef: <i class="conum" data-value="3"></i><b>(3)</b>
        name: cluster-ip
      tls: <i class="conum" data-value="4"></i><b>(4)</b>
        certificateRef:
          name: server-certificate
          kind: Secret</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Identifies the <code>KafkaProxy</code> resource that this virtual cluster is part of.
It must be in the same namespace as the <code>VirtualKafkaCluster</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The virtual cluster names the <code>KafkaService</code> to be proxied.
It must be in the same namespace as the <code>VirtualKafkaCluster</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The virtual cluster can be exposed by one or more ingresses.
Each ingress must reference a <code>KafkaProxyIngress</code> in the same namespace as the <code>VirtualKafkaCluster</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>If the ingress supports TLS, the <code>tls</code> property configures the TLS server certificate to use.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Within a <code>VirtualKafkaCluster</code>, an ingress&#8217;s <code>tls</code> property configures TLS for that ingress.
The <code>tls.certificateRef</code> specifies the <code>Secret</code> resource holding the TLS server certificate that the proxy uses for clients connecting through this ingress.
The referenced <code>KafkaProxyIngress</code> also needs to be configured for TLS.</p>
</div>
<div class="listingblock">
<div class="title">Example <code>KafkaProxyIngress</code> configuration for TLS</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">kind: KafkaProxyIngress
apiVersion: kroxylicious.io/v1alpha1
metadata:
  name: cluster-ip
  namespace: my-proxy
spec:
  proxyRef: <i class="conum" data-value="1"></i><b>(1)</b>
    name: simple
  clusterIP: <i class="conum" data-value="2"></i><b>(2)</b>
    protocol: TLS <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The ingress must reference a <code>KafkaProxy</code> in the same namespace as the <code>KafkaProxyIngress</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Exposes the proxy to Kafka clients inside the same Kubernetes cluster using a <code>ClusterIP</code> service.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The ingress uses <code>TLS</code> as the transport protocol.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="con-kafka-client-mtls-securing"><a class="anchor" href="#con-kafka-client-mtls-securing"></a><a class="link" href="#con-kafka-client-mtls-securing">6.2.2. Mutual TLS configuration for client-to-proxy connections</a></h4>
<div class="paragraph">
<p>You can configure a virtual cluster ingress to request or require Kafka clients to authenticate to the proxy using TLS.
This configuration is known as mutual TLS (mTLS), because both the client and the proxy authenticate each other using TLS.</p>
</div>
<div class="listingblock">
<div class="title">Example <code>VirtualKafkaCluster</code> configuration requiring clients to present a trusted certificate</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">kind: VirtualKafkaCluster
metadata:
  # ...
spec:
  # ...
  ingresses:
    - ingressRef:
        name: cluster-ip
      tls:
        certificateRef:
          # ...
        trustAnchorRef: <i class="conum" data-value="1"></i><b>(1)</b>
          kind: ConfigMap <i class="conum" data-value="2"></i><b>(2)</b>
          name: trusted-cas <i class="conum" data-value="3"></i><b>(3)</b>
          key: trusted-cas.pem <i class="conum" data-value="4"></i><b>(4)</b>
        tlsClientAuthentication: REQUIRED <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>References a separate Kubernetes resource containing the trusted CA certificates.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>kind</code> is optional and defaults to <code>ConfigMap</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Name of the resource of the given <code>kind</code>, which must exist in the same namespace as the <code>VirtualKafkaCluster</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Key identifying the entry in the given resource. The corresponding value must be a set of CA certificates. Supported formats for the bundle are: <code>PEM</code>, <code>PKCS#12</code>, and <code>JKS</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Specifies whether client authentication is required (<code>REQUIRED</code>), requested (<code>REQUESTED</code>), or disabled (<code>NONE</code>). If a <code>trustAnchorRef</code> is specified, the default is <code>REQUIRED</code>.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="con-kafka-client-tls-protocol-securing"><a class="anchor" href="#con-kafka-client-tls-protocol-securing"></a><a class="link" href="#con-kafka-client-tls-protocol-securing">6.2.3. TLS version configuration for client-to-proxy connections</a></h4>
<div class="paragraph">
<p>Some older versions of TLS (and SSL before it) are now considered insecure.
These versions remain enabled by default in order to maximize interoperability between TLS clients and servers that only support older versions.</p>
</div>
<div class="paragraph">
<p>If the Kafka cluster than you want to connect to supports newer TLS versions, you can disable the proxy&#8217;s support for older, insecure versions.
For example, if the Kafka cluster supports TLSv1.1, TLSv1.2 and TLSv1.3 you might choose to enable only TLSv1.3 support.
This would reduce the susceptibility to a TLS downgrade attack.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
It is good practice to disable insecure protocol versions.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can restrict which TLS protocol versions the proxy supports for client-to-proxy connections by configuring the <code>protocols</code> property.</p>
</div>
<div class="listingblock">
<div class="title">Example <code>VirtualKafkaCluster</code> with restricted TLS protocol versions</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">kind: VirtualKafkaCluster
metadata:
  # ...
spec:
  # ...
  ingresses:
    - ingressRef:
        name: cluster-ip
      tls:
        certificateRef:
          # ...
        protocols: <i class="conum" data-value="1"></i><b>(1)</b>
          allow: <i class="conum" data-value="2"></i><b>(2)</b>
            - TLSv1.3</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Configures the TLS protocol versions used by the proxy.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Lists the protocol versions explicitly allowed for TLS negotiation.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Alternatively, you can use <code>deny</code> to specify protocol versions to exclude.</p>
</div>
<div class="paragraph">
<p>The names of the TLS protocol versions supported depend on the JVM in the proxy container image.</p>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://docs.oracle.com/en/java/javase/17/docs/specs/security/standard-names.html#sslcontext-algorithms" target="_blank" rel="noopener">Oracle documentation: SSLContext names</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="con-kafka-client-tls-cipher-securing"><a class="anchor" href="#con-kafka-client-tls-cipher-securing"></a><a class="link" href="#con-kafka-client-tls-cipher-securing">6.2.4. TLS cipher suite configuration for client-to-proxy connections</a></h4>
<div class="paragraph">
<p>A cipher suite is a set of cryptographic algorithms that together provide the security guarantees offered by TLS.
During TLS negotiation, a server and client agree on a common cipher suite that they both support.</p>
</div>
<div class="paragraph">
<p>Some older cipher suites are now considered insecure, but may be enabled on the Kafka cluster to allow older clients to connect.</p>
</div>
<div class="paragraph">
<p>The cipher suites enabled by default in the proxy depend on the JVM used in the proxy image and the TLS protocol version that is negotiated.</p>
</div>
<div class="paragraph">
<p>To prevent TLS downgrade attacks, you can disable cipher suites known to be insecure or no longer recommended.
However, the proxy and the cluster must support at least one cipher suite in common.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
It is good practice to disable insecure cipher suites.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can restrict which TLS cipher suites the proxy uses when negotiating client-to-proxy connections by configuring the <code>cipherSuites</code> property.</p>
</div>
<div class="listingblock">
<div class="title">Example <code>VirtualKafkaCluster</code> configuration using cipherSuites to allow specific ciphers</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">kind: VirtualKafkaCluster
metadata:
  # ...
spec:
  # ...
  ingresses:
    - ingressRef:
        name: cluster-ip
      tls:
        certificateRef:
          # ...
        cipherSuites: <i class="conum" data-value="1"></i><b>(1)</b>
          allow: <i class="conum" data-value="2"></i><b>(2)</b>
           - TLS_AES_128_GCM_SHA256
           - TLS_AES_256_GCM_SHA384</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Configures the cipher suites used by the proxy.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Lists the cipher suites explicitly allowed for TLS negotiation.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Alternatively, you can use <code>deny</code> to specify cipher suites to exclude.
The names of the cipher suites supported depend on the JVM in the proxy container image.</p>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://docs.oracle.com/en/java/javase/21/docs/specs/security/standard-names.html#jsse-cipher-suite-names" target="_blank" rel="noopener">Oracle documentation: JSSE Cipher Suite Names</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="assembly-operator-secure-proxy-broker-connection-securing"><a class="anchor" href="#assembly-operator-secure-proxy-broker-connection-securing"></a><a class="link" href="#assembly-operator-secure-proxy-broker-connection-securing">6.3. Securing the proxy-to-broker connection</a></h3>
<div class="paragraph _abstract">
<p>Secure proxy-to-broker communication using TLS.</p>
</div>
<div class="sect3">
<h4 id="con-configuring-kafkaservice-trust-securing"><a class="anchor" href="#con-configuring-kafkaservice-trust-securing"></a><a class="link" href="#con-configuring-kafkaservice-trust-securing">6.3.1. TLS trust configuration for proxy-to-cluster connections</a></h4>
<div class="paragraph">
<p>By default, the proxy uses the platform&#8217;s default trust store when connecting to the proxied cluster over TLS.
This works if the cluster&#8217;s TLS certificates are signed by a well-known public Certificate Authority (CA), but fails if they’re signed by a private CA instead.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
It is good practice to configure trust explicitly, even when proxied cluster&#8217;s TLS certificates are signed by a public CA.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This example configures a <code>KafkaService</code> to trust TLS certificates signed by any Certificate Authority (CA) listed in the <code>trusted-cas.pem</code> entry of the <code>ConfigMap</code> named <code>trusted-cas</code>.</p>
</div>
<div class="listingblock">
<div class="title">Example <code>KafkaService</code> configuration for trusting certificates.</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">kind: KafkaService
metadata:
  # ...
spec:
  bootstrapServers: kafka.example.com:9092
  tls:
    trustAnchorRef: <i class="conum" data-value="1"></i><b>(1)</b>
      kind: ConfigMap <i class="conum" data-value="2"></i><b>(2)</b>
      name: trusted-cas <i class="conum" data-value="3"></i><b>(3)</b>
      key: trusted-cas.pem <i class="conum" data-value="4"></i><b>(4)</b>
    # ...</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>trustAnchorRef</code> property references a separate Kubernetes resource which contains the CA certificates to be trusted</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>kind</code> is optional and defaults to <code>ConfigMap</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>name</code> of the resource of the given <code>kind</code>. This resource must exist in the same namespace as the <code>KafkaService</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The <code>key</code> identifies the entry in the given resource. The corresponding value must be a PEM-encoded set of CA certificates.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="con-tls-auth-to-kafka-cluster-securing"><a class="anchor" href="#con-tls-auth-to-kafka-cluster-securing"></a><a class="link" href="#con-tls-auth-to-kafka-cluster-securing">6.3.2. TLS authentication to proxied Kafka clusters</a></h4>
<div class="paragraph">
<p>Some Kafka clusters require mutual TLS (mTLS) authentication.
You can configure the proxy to present a TLS client certificate using the <code>KafkaService</code> resource.</p>
</div>
<div class="paragraph">
<p>The TLS client certificate you provide must have been issued by a Certificate Authority (CA) that&#8217;s trusted by the proxied cluster.</p>
</div>
<div class="paragraph">
<p>This example configures a <code>KafkaService</code> to use a TLS client certificate stored in a <code>Secret</code> named <code>tls-cert-for-kafka.example.com</code>.</p>
</div>
<div class="listingblock">
<div class="title">Example <code>KafkaService</code> configuration with TLS client authentication.</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">kind: KafkaService
metadata:
  # ...
spec:
  bootstrapServers: kafka.example.com:9092
  tls:
    trustAnchorRef:
      kind: ConfigMap
      name: trusted-cas
      key: trusted-cas.pem
    certificateRef: <i class="conum" data-value="1"></i><b>(1)</b>
      kind: Secret <i class="conum" data-value="2"></i><b>(2)</b>
      name: tls-cert-for-kafka.example.com <i class="conum" data-value="3"></i><b>(3)</b>
    # ...</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>certificateRef</code> property identifies the TLS client certificate to use.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>kind</code> is optional and defaults to <code>Secret</code>. The <code>Secret</code> should have <code>type: kubernetes.io/tls</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>name</code> is the name of the resource of the given <code>kind</code>. This resource must exist in the same namespace as the <code>KafkaService</code></td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="con-configuring-kafkaservice-protocol-securing"><a class="anchor" href="#con-configuring-kafkaservice-protocol-securing"></a><a class="link" href="#con-configuring-kafkaservice-protocol-securing">6.3.3. TLS version configuration for proxy-to-cluster connections</a></h4>
<div class="paragraph">
<p>Some older versions of TLS (and SSL before it) are now considered insecure.
These versions remain enabled by default in order to maximize interoperability between TLS clients and servers that only support older versions.</p>
</div>
<div class="paragraph">
<p>If the Kafka cluster than you want to connect to supports newer TLS versions, you can disable the proxy&#8217;s support for older, insecure versions.
For example, if the Kafka cluster supports TLSv1.1, TLSv1.2 and TLSv1.3 you might choose to enable only TLSv1.3 support.
This would reduce the susceptibility to a TLS downgrade attack.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
It is good practice to disable insecure protocol versions.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This example configures a <code>KafkaService</code> to allow only TLS v1.3 when connecting to <code>kafka.example.com</code>.</p>
</div>
<div class="listingblock">
<div class="title">Example <code>KafkaService</code> with restricted TLS protocol versions.</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">kind: KafkaService
metadata:
  # ...
spec:
  bootstrapServers: kafka.example.com:9092
  tls:
    # ...
    protocols: <i class="conum" data-value="1"></i><b>(1)</b>
      allow: <i class="conum" data-value="2"></i><b>(2)</b>
        - TLSv1.3</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>protocols</code> property configures the TLS protocol versions</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>allow</code> lists the versions of TLS which are permitted.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>protocols</code> property also supports <code>deny</code>, if you prefer to list the versions to exclude instead.
The names of the TLS protocol versions supported depend on the JVM in the proxy container image.</p>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://docs.oracle.com/en/java/javase/17/docs/specs/security/standard-names.html#sslcontext-algorithms" target="_blank" rel="noopener">Oracle documentation: SSLContext names</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="con-configuring-kafkaservice-cipher-securing"><a class="anchor" href="#con-configuring-kafkaservice-cipher-securing"></a><a class="link" href="#con-configuring-kafkaservice-cipher-securing">6.3.4. TLS cipher suite configuration for proxy-to-cluster connections</a></h4>
<div class="paragraph">
<p>A cipher suite is a set of cryptographic algorithms that together provide the security guarantees offered by TLS.
During TLS negotiation, a server and client agree on a common cipher suite that they both support.</p>
</div>
<div class="paragraph">
<p>Some older cipher suites are now considered insecure, but may be enabled on the Kafka cluster to allow older clients to connect.</p>
</div>
<div class="paragraph">
<p>The cipher suites enabled by default in the proxy depend on the JVM used in the proxy image and the TLS protocol version that is negotiated.</p>
</div>
<div class="paragraph">
<p>To prevent TLS downgrade attacks, you can disable cipher suites known to be insecure or no longer recommended.
However, the proxy and the cluster must support at least one cipher suite in common.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
It is good practice to disable insecure cipher suites.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example <code>KafkaService</code> configured so that the proxy will negotiate TLS connection using only the listed ciphers.</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">kind: KafkaService
metadata:
  # ...
spec:
  bootstrapServers: kafka.example.com:9092
  tls:
    # ...
    cipherSuites: <i class="conum" data-value="1"></i><b>(1)</b>
      allow: <i class="conum" data-value="2"></i><b>(2)</b>
       - TLS_AES_128_GCM_SHA256
       - TLS_AES_256_GCM_SHA384</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>cipherSuites</code> object configures the cipher suites.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>allow</code> lists the cipher suites which are permitted.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>cipherSuites</code> property also supports <code>deny</code>, if you prefer to list the cipher suites to exclude instead.
The names of the cipher suites supported depend on the JVM in the proxy container image.</p>
</div>
<div class="ulist _additional-resources">
<div class="title">Additional resources</div>
<ul>
<li>
<p><a href="https://docs.oracle.com/en/java/javase/21/docs/specs/security/standard-names.html#jsse-cipher-suite-names" target="_blank" rel="noopener">Oracle documentation: JSSE Cipher Suite Names</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="assembly-operator-secure-filter-securing"><a class="anchor" href="#assembly-operator-secure-filter-securing"></a><a class="link" href="#assembly-operator-secure-filter-securing">6.4. Securing filters</a></h3>
<div class="paragraph _abstract">
<p>Secure filters by using the security features provided by each filter and storing sensitive values in external resources such as a Kubernetes <code>Secret</code>.</p>
</div>
<div class="sect3">
<h4 id="security_sensitive_values_in_filter_resources"><a class="anchor" href="#security_sensitive_values_in_filter_resources"></a><a class="link" href="#security_sensitive_values_in_filter_resources">6.4.1. Security-sensitive values in filter resources</a></h4>
<div class="sect4">
<h5 id="template_use_and_value_interpolation"><a class="anchor" href="#template_use_and_value_interpolation"></a><a class="link" href="#template_use_and_value_interpolation">Template use and value interpolation</a></h5>
<div class="paragraph">
<p>Interpolation is supported in <code>spec.configTemplate</code> for the automatic substitution of placeholder values at runtime.
This allows security-sensitive values, such as passwords or keys, to be specified in Kubernetes <code>Secret</code> resources rather than directly in the <code>KafkaProtocolFilter</code> resource.
Likewise, things like trusted CA certificates can be defined in <code>ConfigMap</code> resources.</p>
</div>
<div class="paragraph">
<p>The operator determines which <code>Secret</code> and <code>ConfigMap</code> resources are referenced by a <code>KafkaProtocolFilter</code> resource and declares them as <code>volumes</code> in the proxy <code>Pod</code>, mounted into the proxy container.
This example shows how to configure the <code>RecordEncryptionFilter</code> using a Vault KMS deployed in the same Kubernetes cluster.</p>
</div>
<div class="listingblock">
<div class="title">Example <code>KafkaProtocolFilter</code> configuration</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">kind: KafkaProtocolFilter
metadata:
  # ...
spec:
  type: RecordEncryption <i class="conum" data-value="1"></i><b>(1)</b>
  configTemplate: <i class="conum" data-value="2"></i><b>(2)</b>
    kms: VaultKmsService
    kmsConfig:
      vaultTransitEngineUrl: http://vault.vault.svc.cluster.local:8200/v1/transit
      vaultToken:
        password: ${secret:vault:token} <i class="conum" data-value="3"></i><b>(3)</b>
    selector: TemplateKekSelector
    selectorConfig:
      template: "$(topicName)" <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>type</code> is the Java class name of the proxy filter. If the unqualified name is ambiguous, it must be qualified by the filter package name.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>KafkaProtocolFilter</code> requires a <code>configTemplate</code>, which supports <em>interpolation references</em>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>password</code> uses an <em>interpolation reference</em>, enclosed by <code>${</code> and <code>}</code> instead of a literal value. The operator supplies the value at runtime from the specified <code>Secret</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The selector <code>template</code> is interpreted by the proxy. It uses different delimiters, <code>$(</code> and <code>)</code>, than the <em>interpolation reference</em>.</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="structure_of_interpolation_references"><a class="anchor" href="#structure_of_interpolation_references"></a><a class="link" href="#structure_of_interpolation_references">Structure of interpolation references</a></h5>
<div class="paragraph">
<p>Let&#8217;s look at the example interpolation reference <code>${secret:vault:token}</code> in more detail.</p>
</div>
<div class="paragraph">
<p>It starts with <code>${</code> and ends with <code>}</code>. Between these, it is broken into three parts, separated by colons (<code>:</code>):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>secret</code> is a <em>provider</em>. Supported providers are <code>secret</code> and <code>configmap</code> (note the use of lower case).</p>
</li>
<li>
<p><code>vault</code> is a <em>path</em>. The interpretation of the path depends on the provider.</p>
</li>
<li>
<p><code>token</code> is a <em>key</em>. The interpretation of the key also depends on the provider.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For both <code>secret</code> and <code>configmap</code> providers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The path is interpreted as the name of a <code>Secret</code> or <code>ConfigMap</code> resource in the same namespace as the <code>KafkaProtocolFilter</code> resource.</p>
</li>
<li>
<p>The key is interpreted as a key in the <code>data</code> property of the <code>Secret</code> or <code>ConfigMap</code> resource.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="assembly-operator-monitoring-operator"><a class="anchor" href="#assembly-operator-monitoring-operator"></a><a class="link" href="#assembly-operator-monitoring-operator">7. Monitoring</a></h2>
<div class="sectionbody">
<div class="paragraph _abstract">
<p>Kroxylicious supports key observability features to help you understand the performance and health of your proxy instances.</p>
</div>
<div class="paragraph">
<p>The Kroxylicious Proxy and Kroxylicious Operator generate metrics for real-time monitoring and alerting, as well as logs that capture their actions and behavior.
You can integrate these metrics with a monitoring system like Prometheus for ingestion and analysis, while configuring log levels to control the granularity of logged information.</p>
</div>
<div class="sect2">
<h3 id="con-prometheus-metrics-proxy-operator"><a class="anchor" href="#con-prometheus-metrics-proxy-operator"></a><a class="link" href="#con-prometheus-metrics-proxy-operator">7.1. Overview of proxy metrics</a></h3>
<div class="paragraph _abstract">
<p>The proxy provides metrics for both connections and messages.
These metrics are categorized into downstream (client-side) and upstream (broker-side) groups
They allow users to assess the impact of the proxy and its filters on their Kafka system.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Connection metrics count the connections made from the downstream (incoming connections from the clients) and the connection made by the proxy to upstream (outgoing connections to the Kafka brokers).</p>
</li>
<li>
<p>Message metrics count the number of <a href="https://kafka.apache.org/protocol.html#protocol_messages">Kafka protocol request and response messages</a> that flow through the proxy.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="connection_metrics"><a class="anchor" href="#connection_metrics"></a><a class="link" href="#connection_metrics">7.1.1. Connection metrics</a></h4>
<div class="paragraph">
<p>Connection metrics count the TCP connections made from the client to the proxy (<code>kroxylicious_client_to_proxy_request_total</code>) and from the proxy to the broker (<code>kroxylicious_proxy_to_server_connections_total</code>).
These metrics count connection <em>attempts</em>, so the connection count is incremented even if the connection attempt ultimately fails.</p>
</div>
<div class="paragraph">
<p>In addition to the count metrics, there are error metrics.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If an error occurs whilst the proxy is accepting a connection from the client the <code>kroxylicious_client_to_proxy_errors_total</code> metric is incremented by one.</p>
</li>
<li>
<p>If an error occurs whilst the proxy is attempting a connection to a broker the <code>kroxylicious_proxy_to_server_errors_total</code> metric is incremented by one.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Connection and connection error metrics include the following labels: <code>virtual_cluster</code> (the virtual cluster&#8217;s name) and <code>node_id</code> (the broker&#8217;s node ID).
When the client connects to the boostrap endpoint of the virtual cluster, a node ID value of <code>bootstrap</code> is recorded.</p>
</div>
<div class="paragraph">
<p>The <code>kroxylicious_client_to_proxy_errors_total</code> metric also counts connection errors that occur before a virtual cluster has been identified.
For these specific errors, the <code>virtual_cluster</code> and <code>node_id</code> labels are set to an empty string ("").</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Error conditions signaled <em>within</em> the Kafka protocol response (such as <code>RESOURCE_NOT_FOUND</code> or <code>UNKNOWN_TOPIC_ID</code>) are not classed as errors by these metrics.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Connection metrics for client and broker interactions</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Metric Name</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Labels</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kroxylicious_client_to_proxy_connection_total</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>virtual_cluster</code>, <code>node_id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Incremented by one every time a connection is accepted from a client by the proxy.<br>
 This metric counts all connection attempts that reach the proxy, even those that end in error.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kroxylicious_client_to_proxy_errors_total</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>virtual_cluster</code>, <code>node_id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Incremented by one every time a connection is closed due to any downstream error.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kroxylicious_proxy_to_server_connections_total</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>virtual_cluster</code>, <code>node_id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Incremented by one every time a connection is made to the server from the proxy.<br>
 This metric counts all connections attempted to the broker, even those that end in error.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kroxylicious_proxy_to_server_errors_total</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>virtual_cluster</code>, <code>node_id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Incremented by one every time a connection is closed due to any upstream error.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="message_metrics"><a class="anchor" href="#message_metrics"></a><a class="link" href="#message_metrics">7.1.2. Message metrics</a></h4>
<div class="paragraph">
<p>Message metrics count and record the sizes of the Kafka protocol requests and responses that flow through the proxy.</p>
</div>
<div class="paragraph">
<p>Use these metrics to help understand:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the number of messages flowing through the proxy.</p>
</li>
<li>
<p>the overall volume of data through the proxy.</p>
</li>
<li>
<p>the effect the filters are having on the messages.</p>
</li>
<li>
<p>Downstream metrics</p>
<div class="ulist">
<ul>
<li>
<p><code>kroxylicious_client_to_proxy_request_total</code> counts requests as they arrive from the client.</p>
</li>
<li>
<p><code>kroxylicious_proxy_to_client_response_total</code> counts responses as they are returned to the client.</p>
</li>
<li>
<p><code>kroxylicious_client_to_proxy_request_size_bytes</code> is incremented by the size of each request as it arrives from the client.</p>
</li>
<li>
<p><code>kroxylicious_proxy_to_client_response_size_bytes</code> is incremented by the size of each response as it is returned to the client.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Upstream metrics</p>
<div class="ulist">
<ul>
<li>
<p><code>kroxylicious_proxy_to_server_request_total</code> counts requests as they go to the broker.</p>
</li>
<li>
<p><code>kroxylicious_proxy_to_server_response_total</code> counts responses as they are returned by the broker.</p>
</li>
<li>
<p><code>kroxylicious_proxy_to_server_request_size_bytes</code> is incremented by the size of each request as it goes to the broker.</p>
</li>
<li>
<p><code>kroxylicious_proxy_to_server_response_size_bytes</code> is incremented by the size of each response as it is returned by the broker.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The size recorded is the encoded size of the protocol message. It includes the 4 byte <a href="https://kafka.apache.org/protocol.html#protocol_common">message size</a>.</p>
</div>
<div class="paragraph">
<p>Filters can alter the flow of messages through the proxy or the content of the message.
This is apparent through the metrics.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If a filter sends a short-circuit, or closes a connection the downstream message counters will exceed the upstream counters.</p>
</li>
<li>
<p>If a filter changes the size of the message, the downstream size metrics will be different to the upstream size metrics.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../_assets/monitoring-message-counters.svg" alt="Conceptual diagram showing the downstream and upstream message metrics within the proxy, illustrating how they respond to message transit through it.">
</div>
<div class="title">Figure 3. Downstream and upstream message metrics in the proxy</div>
</div>
<div class="paragraph">
<p>Message metrics include the following labels: <code>virtual_cluster</code> (the virtual cluster&#8217;s name), <code>node_id</code> (the broker&#8217;s node ID), <code>api_key</code> (the message type), <code>api_version</code>, and <code>decoded</code> (a flag indicating if the message was decoded by the proxy).</p>
</div>
<div class="paragraph">
<p>When the client connects to the boostrap endpoint of the virtual cluster, metrics are recorded with a node ID value of <code>bootstrap</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Kafka message metrics for proxy request and response flow</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Metric Name</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Labels</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kroxylicious_client_to_proxy_request_total</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>virtual_cluster</code>, <code>node_id</code>, <code>api_key</code>, <code>api_version</code>, <code>decoded</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Incremented by one every time a request arrives at the proxy from a client.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kroxylicious_proxy_to_server_request_total</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>virtual_cluster</code>, <code>node_id</code>, <code>api_key</code>, <code>api_version</code>, <code>decoded</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Incremented by one every time a request goes from the proxy to a server.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kroxylicious_server_to_proxy_response_total</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>virtual_cluster</code>, <code>node_id</code>, <code>api_key</code>, <code>api_version</code>, <code>decoded</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Incremented by one every time a response arrives at the proxy from a server.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kroxylicious_proxy_to_client_response_total</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>virtual_cluster</code>, <code>node_id</code>, <code>api_key</code>, <code>api_version</code>, <code>decoded</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Incremented by one every time a response goes from the proxy to a client.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kroxylicious_client_to_proxy_request_total</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Distribution</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>virtual_cluster</code>, <code>node_id</code>, <code>api_key</code>, <code>api_version</code>, <code>decoded</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Incremented by the size of the message each time a request arrives at the proxy from a client.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kroxylicious_proxy_to_server_request_total</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Distribution</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>virtual_cluster</code>, <code>node_id</code>, <code>api_key</code>, <code>api_version</code>, <code>decoded</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Incremented by the size of the message each time a request goes from the proxy to a server.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kroxylicious_server_to_proxy_response_total</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Distribution</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>virtual_cluster</code>, <code>node_id</code>, <code>api_key</code>, <code>api_version</code>, <code>decoded</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Incremented by the size of the message each time a response arrives at the proxy from a server.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>kroxylicious_proxy_to_client_response_total</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Distribution</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>virtual_cluster</code>, <code>node_id</code>, <code>api_key</code>, <code>api_version</code>, <code>decoded</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Incremented by the size of the message each time a response goes from the proxy to a client.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="con-prometheus-metrics-operator-operator"><a class="anchor" href="#con-prometheus-metrics-operator-operator"></a><a class="link" href="#con-prometheus-metrics-operator-operator">7.2. Overview of operator metrics</a></h3>
<div class="paragraph _abstract">
<p>The Kroxylicious Operator is implemented using the <a href="https://javaoperatorsdk.io/">Java Operator SDK</a>.
The Java Operator SDK exposes metrics that allow its behavior to be understood.
These metrics are enabled by default in the Kroxylicious Operator.</p>
</div>
<div class="paragraph">
<p>Refer to the <a href="https://github.com/operator-framework/java-operator-sdk/blob/v5.0.4/docs/content/en/docs/features/_index.md#operator-sdk-metrics">Java Operator SDK metric documentation</a> to learn more about metrics.</p>
</div>
</div>
<div class="sect2">
<h3 id="con-operator-ingesting-metrics-operator"><a class="anchor" href="#con-operator-ingesting-metrics-operator"></a><a class="link" href="#con-operator-ingesting-metrics-operator">7.3. Ingesting metrics</a></h3>
<div class="paragraph _abstract">
<p>Metrics from the Kroxylicious Proxy and Kroxylicious Operator can be ingested into your Prometheus instance.
The proxy and the operator each expose an HTTP endpoint for Prometheus metrics at the <code>/metrics</code> address.
The endpoint does not require authentication.</p>
</div>
<div class="paragraph">
<p>For the Proxy, the port that exposes the scrape endpoint is named <code>management</code>.
For the Operator, the port is named <code>http</code>.</p>
</div>
<div class="paragraph">
<p>Prometheus can be configured to ingest the metrics from the scrape endpoints.</p>
</div>
<div class="paragraph">
<p>This guide assumes you are using the <a href="https://prometheus-operator.dev/">Prometheus Operator</a> to configure Prometheus.</p>
</div>
<div class="sect3">
<h4 id="proc-operator-ingesting-metrics-operatoroperator"><a class="anchor" href="#proc-operator-ingesting-metrics-operatoroperator"></a><a class="link" href="#proc-operator-ingesting-metrics-operatoroperator">7.3.1. Ingesting operator metrics</a></h4>
<div class="paragraph _abstract">
<p>This procedure describes how to ingest metrics from the Kroxylicious Operator into Prometheus.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Kroxylicious Operator is installed.</p>
</li>
<li>
<p><a href="https://prometheus-operator.dev/">Prometheus Operator</a> is installed, and a Prometheus instance has been created using the <a href="https://prometheus-operator.dev/docs/api-reference/api/#monitoring.coreos.com/v1.Prometheus"><code>Prometheus</code> custom resource</a>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Apply the PodMonitor configuration:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: monitoring.coreos.com/v1
kind: PodMonitor
metadata:
  name: operator
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: kroxylicious
      app.kubernetes.io/component: operator
  podMetricsEndpoints:
  - path: /metrics
    port: http</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Prometheus Operator reconfigures Prometheus automatically.
Prometheus begins to regularly to scrape the Kroxylicious Operator&#8217;s metric.</p>
</div>
</li>
<li>
<p>Check the metrics are being ingested using a PromQL query such as:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">operator_sdk_reconciliations_queue_size_kafkaproxyreconciler{kind="KafkaProxy", group="kroxylicious.io"}</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="proc-operator-ingesting-metrics-proxyoperator"><a class="anchor" href="#proc-operator-ingesting-metrics-proxyoperator"></a><a class="link" href="#proc-operator-ingesting-metrics-proxyoperator">7.3.2. Ingesting proxy metrics</a></h4>
<div class="paragraph _abstract">
<p>This procedure describes how to ingest metrics from the Kroxylicious Proxy into Prometheus.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Kroxylicious Operator is installed.</p>
</li>
<li>
<p>An instance of Kroxylicious deployed by the operator.</p>
</li>
<li>
<p><a href="https://prometheus-operator.dev/">Prometheus Operator</a> is installed, and a Prometheus instance has been created using the <a href="https://prometheus-operator.dev/docs/api-reference/api/#monitoring.coreos.com/v1.Prometheus"><code>Prometheus</code> custom resource</a>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Apply the PodMonitor configuration:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: monitoring.coreos.com/v1
kind: PodMonitor
metadata:
  name: proxy
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: kroxylicious
      app.kubernetes.io/component: proxy
  podMetricsEndpoints:
  - path: /metrics
    port: management</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Prometheus Operator reconfigures Prometheus automatically.
Prometheus begins to regularly to scrape the proxy&#8217;s metric.</p>
</div>
</li>
<li>
<p>Check the metrics are being ingested using a PromQL query such as:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">kroxylicious_build_info</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="con-operator-setting-log-levels-operator"><a class="anchor" href="#con-operator-setting-log-levels-operator"></a><a class="link" href="#con-operator-setting-log-levels-operator">7.4. Setting log levels</a></h3>
<div class="paragraph _abstract">
<p>You can independently control the logging level of both the Kroxylicious Operator and the Kroxylicious Proxy.</p>
</div>
<div class="paragraph">
<p>In both cases, logging levels are controlled using two environment variables:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>KROXYLICIOUS_APP_LOG_LEVEL</code> controls the logging of the application (<code>io.kroxylicious</code> loggers). It defaults to <code>INFO</code>.</p>
</li>
<li>
<p><code>KROXYLICIOUS_ROOT_LOG_LEVEL</code> controls the logging level at the root. It defaults to <code>WARN</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When trying to diagnose a problem, start first by raising the logging level of <code>KROXYLICIOUS_APP_LOG_LEVEL</code>.
If more detailed diagnostics are required, try raising the <code>KROXYLICIOUS_ROOT_LOG_LEVEL</code>. Both the proxy and operator
use Apache Log4J2 and use logging levels understood by it: <code>TRACE</code>, <code>DEBUG</code>, <code>INFO</code>, <code>WARN</code>, and <code>ERROR</code>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
WARNING: Running the operator or the proxy at elevated logging levels, such as <code>DEBUG</code> or <code>TRACE</code>, can generate a large volume of logs, which may consume significant storage and affect performance.
Run at these levels only as long as necessary.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="proc-operator-setting-log-levels-proxyoperator"><a class="anchor" href="#proc-operator-setting-log-levels-proxyoperator"></a><a class="link" href="#proc-operator-setting-log-levels-proxyoperator">7.4.1. Overriding proxy logging levels</a></h4>
<div class="paragraph _abstract">
<p>This procedure describes how to override the logging level of the Kroxylicious Proxy.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>An instance of Kroxylicious deployed by the Kroxylicious Operator.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Apply the <code>KROXYLICIOUS_APP_LOG_LEVEL</code> or <code>KROXYLICIOUS_ROOT_LOG_LEVEL</code> environment variable to the proxy&#8217;s Kubernetes <code>Deployment</code> resource:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl set env -n &lt;namespace&gt; deployment &lt;deployment_name&gt; KROXYLICIOUS_APP_LOG_LEVEL=DEBUG</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Deployment</code> resource has the same name as the <code>KafkaProxy</code>.</p>
</div>
<div class="paragraph">
<p>Kubernetes recreates the proxy pod automatically.</p>
</div>
</li>
<li>
<p>Verify that the new logging level has taken affect:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl logs -f -n &lt;namespace&gt; deployment/&lt;deployment_name&gt;</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="reverting_proxy_logging_levels"><a class="anchor" href="#reverting_proxy_logging_levels"></a><a class="link" href="#reverting_proxy_logging_levels">Reverting proxy logging levels</a></h5>
<div class="paragraph">
<p>This procedure describes how to revert the logging level of the Kroxylicious Proxy back to its defaults.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>An instance of Kroxylicious deployed by the Kroxylicious Operator.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Remove the <code>KROXYLICIOUS_APP_LOG_LEVEL</code> or <code>KROXYLICIOUS_ROOT_LOG_LEVEL</code> environment variable from the proxy&#8217;s Kubernetes Deployment:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl set env -n &lt;namespace&gt; deployment &lt;deployment_name&gt; KROXYLICIOUS_APP_LOG_LEVEL-</code></pre>
</div>
</div>
<div class="paragraph">
<p>Kubernetes recreates the proxy pod automatically.</p>
</div>
</li>
<li>
<p>Verify that the logging level has reverted to its default:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl logs -f -n &lt;namespace&gt; deployment/&lt;deployment_name&gt;</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="proc-operator-setting-log-levels-operator-bundle-operator"><a class="anchor" href="#proc-operator-setting-log-levels-operator-bundle-operator"></a><a class="link" href="#proc-operator-setting-log-levels-operator-bundle-operator">7.4.2. Overriding the operator logging level (operator installed by bundle)</a></h4>
<div class="paragraph _abstract">
<p>This procedure describes how to override the logging level of the Kroxylicious Operator.
It applies when the operator was installed from the YAML bundle.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Kroxylicious Operator installed from the YAML bundle.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Apply the <code>KROXYLICIOUS_APP_LOG_LEVEL</code> or <code>KROXYLICIOUS_ROOT_LOG_LEVEL</code> environment variable to the operator&#8217;s Kubernetes Deployment:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl set env -n kroxylicious-operator deployment kroxylicious-operator KROXYLICIOUS_APP_LOG_LEVEL=DEBUG</code></pre>
</div>
</div>
<div class="paragraph">
<p>Kubernetes recreates the operator pod automatically.</p>
</div>
</li>
<li>
<p>Verify that the new logging level has taken affect:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl logs -f -n kroxylicious-operator deployment/kroxylicious-operator</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="reverting_operator_logging_levels"><a class="anchor" href="#reverting_operator_logging_levels"></a><a class="link" href="#reverting_operator_logging_levels">Reverting operator logging levels</a></h5>
<div class="paragraph">
<p>This procedure describes how to revert the logging level of the Kroxylicious Operator back to its defaults.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Kroxylicious Operator installed from the YAML bundle.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Remove the <code>KROXYLICIOUS_APP_LOG_LEVEL</code> or <code>KROXYLICIOUS_ROOT_LOG_LEVEL</code> environment variable from the proxy&#8217;s Kubernetes Deployment:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl set env -n kroxylicious-operator deployment kroxylicious-operator KROXYLICIOUS_APP_LOG_LEVEL-</code></pre>
</div>
</div>
<div class="paragraph">
<p>Kubernetes recreates the operator pod automatically</p>
</div>
</li>
<li>
<p>Verify that the logging level has reverted to its default:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">kubectl logs -f -n kroxylicious-operator deployment/kroxylicious-operator</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="glossary"><a class="anchor" href="#glossary"></a><a class="link" href="#glossary">8. Glossary</a></h2>
<div class="sectionbody">
<div class="dlist">
<dl>
<dt class="hdlist1">API</dt>
<dd>
<p>Application Programmer Interface.</p>
</dd>
<dt class="hdlist1">CA</dt>
<dd>
<p>Certificate Authority. An organization that issues certificates.</p>
</dd>
<dt class="hdlist1">CR</dt>
<dd>
<p>Custom Resource. An instance resource of a CRD. In other words, a resource of a kind that is not built into Kubernetes.</p>
</dd>
<dt class="hdlist1">CRD</dt>
<dd>
<p>Custom Resource Definition. A Kubernetes API for defining Kubernetes API extensions.</p>
</dd>
<dt class="hdlist1">KMS</dt>
<dd>
<p>Key Management System. A dedicated system for controlling access to cryptographic material, and providing operations which use that material.</p>
</dd>
<dt class="hdlist1">mTLS</dt>
<dd>
<p>Mutual Transport Layer Security. A configuration of TLS where the client presents a certificate to a server, which the server authenticates.</p>
</dd>
<dt class="hdlist1">TLS</dt>
<dd>
<p>The Transport Layer Security. A secure transport protocol where a server presents a certificate to a client, which the client authenticates. TLS was previously known as the Secure Sockets Layer (SSL).</p>
</dd>
<dt class="hdlist1">TCP</dt>
<dd>
<p>The Transmission Control Protocol.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect1">
<h2 id="trademark_notice"><a class="anchor" href="#trademark_notice"></a><a class="link" href="#trademark_notice">9. Trademark notice</a></h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Apache Kafka is a registered trademark of The Apache Software Foundation.</p>
</li>
<li>
<p>Kubernetes is a registered trademark of The Linux Foundation.</p>
</li>
<li>
<p>Prometheus is a registered trademark of The Linux Foundation.</p>
</li>
<li>
<p>Strimzi is a trademark of The Linux Foundation.</p>
</li>
<li>
<p>Hashicorp Vault is a registered trademark of HashiCorp, Inc.</p>
</li>
<li>
<p>AWS Key Management Service is a trademark of Amazon.com, Inc. or its affiliates.</p>
</li>
<li>
<p>Fortanix and Data Security Manager are trademarks of Fortanix, Inc.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2025-07-17 17:38:31 UTC
</div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.3/highlight.min.js"></script>
<script>
if (!hljs.initHighlighting.called) {
  hljs.initHighlighting.called = true
  ;[].slice.call(document.querySelectorAll('pre.highlight > code[data-lang]')).forEach(function (el) { hljs.highlightBlock(el) })
}
</script>
</body>
</html>